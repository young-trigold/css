**目录：**

- [1. CSS 简介](#1-css-简介)
  - [1.1. CSS 背景](#11-css-背景)
  - [1.2. 惯例](#12-惯例)
    - [1.2.1. CSS 属性定义](#121-css-属性定义)
    - [1.2.2. 简写属性](#122-简写属性)
      - [1.2.2.1. all 属性](#1221-all-属性)
  - [1.3. 引入 CSS](#13-引入-css)
    - [1.3.1. 外部样式表](#131-外部样式表)
    - [1.3.2. 内部样式表](#132-内部样式表)
    - [1.3.3. 行内样式](#133-行内样式)
  - [1.4. CSS 处理模型](#14-css-处理模型)
    - [1.4.1. CSS 2.2 引用模型](#141-css-22-引用模型)
  - [1.5. 定义](#15-定义)

# 1. CSS 简介

## 1.1. CSS 背景

自从 CSS2 规范在 1998 年成为一项提议以来，CSS 社区已经获得了大量的经验。CSS2 规范中的错误随后在 2011 年的第一个修订版[CSS21]中得到了纠正，但新的勘误是必要的。

虽然许多问题将由即将发布的 CSS3 规范来解决，但目前的状况阻碍了 CSS2 的实施和互操作性。CSS2.2 规范试图通过以下方式来解决这种情况：

- 保持与 CSS2 中被广泛接受和实施的那些部分的兼容性。
- 纳入所有公布的 CSS2 勘误。
- 在实施与 CSS2 规范有很大差异的情况下，对规范进行修改以符合普遍接受的做法。
- 删除那些由于没有被实施而被 CSS 社区拒绝的 CSS2 特性。CSS2.2 旨在反映哪些 CSS 特性被合理地广泛用于一般的 HTML 和 XML 语言(而不是只用于特定的 XML 语言，或只用于 HTML)。
- 删除将被 CSS3 淘汰的 CSS2 特性，从而鼓励采用拟议的 CSS3 特性来取代它们。
- 添加(非常)少的新属性值，当实施经验表明它们是实施 CSS2 所需要的。

因此，虽然 CSS2 样式表不一定与 CSS2.2 向前兼容，但限制自己使用 CSS2.2 特性的样式表更有可能在今天找到一个兼容的用户代理，并在将来保持向前兼容。虽然破坏向前兼容性是不可取的，但我们相信 CSS 2.2 中的修订的好处是值得的。

CSS 2.2 源于 CSS 2.1 和 CSS2，并打算以此取代 CSS2。CSS2 的某些部分在 CSS 2.2 中没有变化，某些部分被改变了，还有一些部分被移除。被删除的部分可能会在未来的 CSS3 规范中使用。未来的规范应该参考 CSS2.2(除非它们需要 CSS2 中的一些功能，而这些功能在 CSS2 中被取消了，那么它们应该只参考 CSS2 的这些功能，或者最好是在包括这些功能的相应的 CSS3 模块中参考这些功能)。

本规范的编写考虑到了两类读者：CSS 作者和 CSS 实现者。我们希望本规范能够为作者提供编写高效、有吸引力和可访问的文档所需的工具，而不会让他们过度暴露于 CSS 的实现细节。然而，实现者应该能找到他们所需要的一切，以建立符合要求的用户代理。本规范从对 CSS 的一般介绍开始，到最后变得越来越技术化和具体化。为了快速获取信息，在电子版和印刷版中都有一个总的目录，在每一节的开头都有具体的目录，还有一个索引，以方便浏览。

本规范的编写考虑到了两种表述方式：电子版和印刷版。尽管这两种表述方式无疑是相似的，但读者会发现一些差异。例如，链接在印刷版中不起作用(很明显)，而页码在电子版中不会出现。在出现差异的情况下，电子版被认为是文件的权威版本。

## 1.2. 惯例

### 1.2.1. CSS 属性定义

每个 CSS 属性定义的开头都有一个关键信息的摘要，类似于以下内容：

| 属性名   | 属性的名字         |
| -------- | ------------------ |
| 属性值   | 合法值和语法       |
| 初始值   | 初始值             |
| 适用元素 | 该属性适用的元素   |
| 可继承性 | 该属性是否可被继承 |
| 百分数值 | 百分数值解释方式   |
| 适用媒体 | 该属性适用的媒体组 |
| 计算值   | 计算值的计算方式   |

- **属性值**

这一部分规定了属性值的有效值集。一个属性值可以有一个或多个组件。

- **初始值**

这一部分指定了属性的初始值。关于样式表指定的、继承的和初始属性值之间的交互信息，请参考 [层叠](#44-层叠) 部分。

- **适用元素**

这一部分列出了该属性所适用的元素。所有的元素都被认为拥有所有的属性，但有些属性对某些类型的元素没有渲染效果。例如，'clear' 属性只影响到块级元素。

- **可继承性**

这一部分表示该属性的值是否从祖先元素继承。关于样式表指定的、继承的和初始属性值之间的交互信息，请参考 [层叠](#44-层叠) 部分。

- **百分数值**

如果百分数值出现在属性的值中，这部分表明应如何解释百分数值。如果 "N/A" 出现在这里，这意味着该属性不接受百分数值。

- **适用媒体**

这一部分表示该属性所适用的媒体组。请参见 [媒体类型](#16-媒体类型) 部分。

- **计算值**

这一部分描述了该属性的计算值。关于此定义的使用方法，请参见 [计算值](#412-计算值) 部分。

### 1.2.2. 简写属性

有些属性是 **简写属性**，意思是它们允许作者用一个属性指定几个属性的值。一个简写属性设置了它所有的长式子属性，就像在原地展开一样。

当值从简写形式中省略时，除非另有定义，否则每个“缺失的”子属性都会被分配其初始值。

这意味着一个简写属性声明总是设置其所有的子属性，甚至那些没有明确设置的子属性。如果不小心使用，这可能会导致无意中重新设置一些子属性。谨慎地使用，简写可以通过重设不经意间从其他来源串联的子属性来保证 "白板"。
例如，写 background: green 而不是 background-color: green 可以确保背景色覆盖任何先前的声明，这些声明可能将背景设置为带有 background-image 的图像。

例如，CSS level 1 'font' 属性是一个简写属性，用于一次性设置 font-style、font-variant、font-weight、font-size、line-height 和 font-family。这个例子中的多个声明：

```css
h1 {
  font-weight: bold;
  font-size: 12pt;
  line-height: 14pt;
  font-family: Helvetica;
  font-variant: normal;
  font-style: normal;
}
```

因此，可以改写为：

```css
h1 {
  font: bold 12pt/14pt Helvetica;
}
```

随着更多的字体子属性被引入到 CSS 中，简写声明也会将这些子属性重置为初始值。

在某些情况下，一个简写项可能会有不同的语法或特殊的关键字，它们并不直接对应于其子属性的值。(在这种情况下，简写项将明确地定义其值的扩展)。

在其他情况下，一个属性可能是简写属性的一个 **只重置的子属性**。像其他子属性一样，当未指定时，它被简写属性重置为其初始值，但简写属性可能不包括将该子属性设置为其任何其他值的语法。例如，border 简写属性将 border-image 重置为其初始值 none，但没有语法将其设置为任何其他值。

如果一个简写属性被指定为全局关键字之一，它就会将其所有的子属性设置为该关键字，包括任何只重置的子属性。(注意，这些关键字不能在一个声明中与其他值结合，甚至在一个简写中也不行)。

将一个简写属性声明为!important 等同于将其所有的子属性声明为!important。

#### 1.2.2.1. all 属性

| 属性名   | all        |
| -------- | ---------- | ------- | ------ |
| 值       | `initial   | inherit | unset` |
| 初始值   | 见单独属性 |
| 适用元素 | 见单独属性 |
| 可继承   | 见单独属性 |
| 百分数   | 见单独属性 |
| 计算值   | 见单独属性 |

all 属性是一个简写属性，可以重置除 'direction' 和 'unicode-bidi' 之外的所有 CSS 属性。它只接受 CSS 范围内的关键字。它不会重置自定义属性[css-variables-1]。

注意：除了方向和 unicode-bidi 之外的 CSS 属性实际上是标记级的特性，不应该在作者的样式表中设置。(它们作为 CSS 属性存在，只是为了给 UA 不支持的文档语言设置样式)。作者应该使用适当的标记，如 HTML 的 dir 属性，而不是。[css-writing-modes-3]。

例如，如果作者在一个元素上指定了 `all: initial`，它将阻止所有的继承并重置所有的属性，就像没有规则出现在级联的作者、用户或 user-agent 层一样。

这对包含在一个页面中的 "组件" 的根元素很有用，它不希望继承外部页面的样式。然而，请注意，任何应用于该元素的“默认”样式(例如，来自`<div>`等块级元素的 UA 样式表的 `display: block`) 也将被覆盖。

## 1.3. 引入 CSS

在学习 CSS 之前，我们得首先在 HTML 关联 CSS，不然 CSS 就没法影响 HTML 文档。下面介绍 3 种引入 CSS 的方式。

### 1.3.1. 外部样式表

外部样式表式引入 CSS 最常用的方式。这种方式用到了 link 元素，例如：

```html
<!DOCTYPE html>
<html>
  <head>
    <title>外部样式表</title>
    <link rel="stylesheet" href="style.css" media="screen" />
  </head>
  <body></body>
</html>
```

上述例子向 HTML 文档中引入了一个 style.css 外部样式表。

外部样式表中没有任何 HTML 标签。外部样式表保存为纯文本文件，文件扩展名是 .css。

- link 元素的属性

link 元素的 rel 属性表示链接资源和 HTML 文档的关系，对于 CSS 文档来说，就是“stylesheet”。

link 元素的 href 属性制定了链接资源的地址。

最后的 media 属性，它的值是一个或多个媒体描述符(media descriptor)，表示什么样的媒体应该使用这个 CSS 文档。例如：

```html
<link rel="stylesheet" href="style.css" media="screen, screen" />
```

多个媒体描述符用逗号分隔。媒体描述符本书后面会详细的介绍。

link 的 type 属性现在已经不常用了，它用来指定资源的 MIME 类型，不过对于 CSS 文档，浏览器默认为 "text/css"。

- @import

@import 指令可以出现在 CSS 文档中，它的作用是链接另外一个 CSS 文档。例如：

```css
@import url(basic.css);
```

@import 指令必需放在 CSS 规则之前，否则不会有效。

### 1.3.2. 内部样式表

另外一种引入 CSS 的方式是通过 style 元素。例如：

```html
<!DOCTYPE html>
<html>
  <head>
    <title>内部样式表</title>
    <style>
      h1 {
        color: red;
      }

      h2 {
        color: maroon;
        background: black;
      }
    </style>
  </head>
  <body></body>
</html>
```

### 1.3.3. 行内样式

最后一种的方式是通过 HTML 元素的 style 全局属性。例如：

```html
<!DOCTYPE html>
<html>
  <head>
    <title>行内样式</title>
  </head>
  <body>
    <p style="color: red;">一段文本。</p>
  </body>
</html>
```

## 1.4. CSS 处理模型

本节介绍了支持 CSS 的用户代理如何工作的一个可能模型。这只是一个概念性的模型；实际的实现可能会有所不同。

在这个模型中，用户代理通过以下步骤来处理一个来源：

1. 解析源文档并创建一个文档树。
2. 识别目标媒体类型。
3. 检索所有与该文档相关的、为目标媒体类型指定的样式表。
4. 通过给适用于目标媒体类型的每个属性分配一个单一的值来注释文档树的每个元素。属性是根据层叠和继承一节中描述的机制来分配数值的。部分数值的计算取决于适合于目标媒体类型的格式化算法。例如，如果目标媒体是屏幕，用户代理会应用视觉格式化模型。
5. 从注释的文档树中，生成一个格式化结构。通常，格式化结构与文档树非常相似，但也可能有很大不同，特别是当作者使用伪元素和生成的内容时。首先，格式化结构根本不需要是 "树形" 的，结构的性质取决于实现。第二，格式化结构可能包含比文档树更多或更少的信息。例如，如果文档树中的一个元素的 'display' 属性的值是 'none'，那么这个元素在格式化结构中就不会产生任何信息。另一方面，一个列表元素可能会在格式化结构中产生更多的信息：列表元素的内容和列表样式信息(例如，一个子弹头图像)。请注意，CSS 用户代理在这个阶段不会改变文档树。特别是，由于样式表产生的内容不会被反馈给文档语言处理器(例如，用于重新解析)。
6. 将格式化结构转移到目标媒体(例如，打印结果、在屏幕上显示、渲染成语音等)。

### 1.4.1. CSS 2.2 引用模型

CSS 2.2 选择器和属性允许样式表引用文档或用户代理的以下部分：

- 文档树中的元素和它们之间的某些关系(见选择器部分)。
- 文档树中的元素的属性，以及这些属性的值(见关于属性选择器的部分)。
- 元素内容的某些部分(见 :first-line 和 :first-letter 伪元素)。
- 当文档树的元素处于某种状态时(见关于伪类的部分)。
- 文档将被渲染的画布的某些方面。
- 一些系统信息(见用户界面部分)。

## 1.5. 定义

- **样式表**

一组指定文档表现形式的语句。

样式表可能有三个不同的来源：作者、用户、和用户代理。这些来源的互交互性在 [层叠和继承](#4-层叠和继承) 一节中描述。

- **有效样式表**

样式表的有效性取决于样式表所使用的 CSS 的级别。所有有效的 CSS1 样式表都是有效的 CSS2.2 样式表，但是 CSS1 的一些变化意味着一些 CSS1 样式表在 CSS2.2 中会有轻微的语义不同。CSS2 中的一些特性不是 CSS2.2 的一部分，所以不是所有的 CSS2 样式表都是有效的 CSS2.2 样式表。

一个有效的 CSS2.2 样式表必须按照 CSS2.2 的语法来写。此外，它必须只包含本规范中定义的 at-rules、属性名称和属性值。一个非法的(无效的)at-rule、属性名或属性值是无效的。

- **源文档**

一个或多个样式表所适用的文档。这是用某种语言编码的，它把文档表示为一棵元素树。每个元素由一个识别元素类型的名称、可选择的一些属性和一个(可能是空的)内容组成。例如，源文件可以是一个 XML 或 SGML 实例。

- **文档语言**

源文档的编码语言(例如，HTML、XHTML 或 SVG)。CSS 用于描述文档语言的表现形式，CSS 并不改变文档语言的基本语义。

- **元素**

文档语言的主要语法结构。大多数 CSS 样式表规则使用这些元素的名称(如 HTML 中的 P、TABLE 和 OL)来指定这些元素应该如何被呈现。

- **替换性元素**

一个内容不在 CSS 格式化模型范围内的元素，如图像、嵌入式文档或小程序。例如，HTML IMG 元素的内容经常被其 "src" 属性指定的图像所取代。替换性元素通常有固有的尺寸：固有的宽度、固有的高度和固有的比例。例如，一个位图图像有一个以绝对单位指定的固有宽度和固有高度(固有尺寸比显然可以从这里确定)。另一方面，其他文档可能没有任何固有的尺寸(例如，一个空白的 HTML 文档)。

如果用户代理认为一个替换性元素没有任何固有的尺寸，那么这些尺寸可能会向第三方泄露敏感信息。例如，如果一个 HTML 文档根据用户的银行余额改变了固有的尺寸，那么 UA 可能希望像该资源没有固有的尺寸一样行事。

替换性元素的内容在 CSS 渲染模型中不被考虑。

- **固有尺寸**

由元素本身定义的宽度和高度，而不是由周围环境强加的。CSS 并没有定义如何找到固有尺寸。在 CSS 2.2 中，只有替换性元素可以带有固有的尺寸。对于没有可靠分辨率信息的光栅图像，必须假定每个图像源像素的尺寸为 1px 单位。

- **属性**

一个与元素相关的值，由一个名称和一个相关的(文本)值组成。

- **内容**

在源文档中与一个元素相关的内容。有些元素没有内容，在这种情况下，它们被称为 **空元素**。一个元素的内容可能包括文本，也可能包括一些子元素，在这种情况下，该元素被称为这些子元素的父元素。

- **忽略**

这个术语在本规范中有两种略有不同的含义。首先，一个 CSS 解析器在发现样式表中的未知或非法语法时必须遵循某些规则。然后，解析器必须忽略样式表的某些部分。哪些部分必须被忽略的确切规则在这些章节(声明和属性、处理解析错误的规则、不支持的值)中描述，或者可以在术语 "忽略 "出现的文本中解释。第二，一个用户代理可以(而且在某些情况下必须)不理会样式表中的某些属性或值，即使语法是合法的。例如，表列元素不能影响表列的字体，所以字体属性必须被忽略。

- **渲染内容**

一个元素的内容在根据相关样式表适用于它的渲染后被应用。一个替换性元素的内容是如何被渲染的，本规范没有定义。渲染的内容也可以是一个元素的替代文本(例如，XHTML "alt" 属性的值)，并可能包括由样式表隐含地或显式地插入的项目，如栏目、编号等。

- **文档树**
  在源文档中编码的元素树。这个树中的每个元素都有一个父元素，但根元素除外，它没有。

- **子元素**

当且仅当 B 是 A 的父元素时，一个元素 A 被称为元素 B 的子元素。

- **后代元素**

一个元素 A 被称为元素 B 的后代元素，如果(1)A 是 B 的一个子元素，或者(2)A 是某个元素 C 的子元素，而这个元素 C 是 B 的后代元素。

- **祖先元素**

当且仅当 B 是 A 的后代元素时，元素 A 被称为元素 B 的祖先元素。

- **兄弟元素**

一个元素 A 被称为元素 B 的兄弟元素，当且仅当 B 和 A 共享同一个父元素。如果元素 A 在文档树中排在元素 B 之前，它就是一个前级兄弟元素。如果元素 B 在文档树中排在 A 的后面，那么它就是一个跟随的兄弟元素。

- **前置元素**

当且仅当(1)A 是 B 的祖先或(2)A 是 B 的前面的兄弟元素时，一个元素 A 被称为元素 B 的前置元素。

- **后置元素**

当且仅当 B 是 A 的前面的元素时，一个元素 A 被称为 B 的后置元素。

- **作者**

作者是一个编写文档和相关样式表的人。编写工具是一个生成样式表的用户代理。

- **用户**

用户是与用户代理互动以查看、听取或以其他方式使用一个文件及其相关的样式表的人。用户可以提供一个编码个人偏好的个人样式表。

- **用户代理(UA)**

用户代理是任何解释以文档语言编写的文档并根据本规范的条款应用相关样式表的程序。一个用户代理可以显示一个文档，大声朗读它，使它被打印出来，把它转换成另一种格式，等等。

一个 HTML 用户代理是一个支持一个或多个 HTML 规范的用户代理。一个支持 XHTML[XHTML]，但不支持 HTML 的用户代理不被认为是一个符合本规范的 HTML 用户代理。

- **属性**

CSS 定义了一个有限的参数集，称为属性，用于指导文档的渲染。每个属性都有一个名称(例如，'color'、'font' 或 'border')和一个值(例如，'red'、'12pt' 或 'dotted')。属性通过特指度、层叠和继承等机制被附加到文档的各个部分和显示文档的页面上(见 "属性值、层叠和继承" 章节)。
