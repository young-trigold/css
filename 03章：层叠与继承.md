**目录：**

- [3. 层叠与继承](#3-层叠与继承)
  - [3.1. 用户代理样式](#31-用户代理样式)
  - [3.2. 样式的层叠](#32-样式的层叠)
  - [3.3. !important](#33-important)
  - [3.4. 样式冲突](#34-样式冲突)
  - [3.5. 继承](#35-继承)

# 3. 层叠与继承

要想掌握样式表，弄清样式层叠和继承这两个概念是关键。浏览器根据层叠和继承规则确定显示一个元素时各种样式属性采用的值。每个元素都有一套浏览器呈现页面时要用到的 CSS 属性。对于每一个这种属性，浏览器都需要查看一下其所有的样式来源。前面已经讲过三种定义样式的方式（行内样式、内部样式表和外部样式表），但是要知道，样式还有另外一种来源。

## 3.1. 用户代理样式

用户代理样式一般指元素尚未设置样式时浏览器应用在它身上的默认样式。这些样式因浏览器而略有差异，不过大体一致。以 a 元素（超链接）为例，想想没有特别为它定义样式时浏览器会怎样显示。下面代码所示为一个不含任何样式的简单 HTML 文档。

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <a href="http://www.google.com/">google</a>
  </body>
</html>
```

我们对浏览器应用于链接的样式早已习以为常，以至于不会留意到它的存在。用户代理样式可以通过浏览器的控制台查看。如下是 Chrome 浏览器中，上面超链接的用户代理样式：

```css
a:-webkit-any-link {
  color: -webkit-link;
  cursor: pointer;
  text-decoration: underline;
}
```

虽然不是每一个 HTML 元素都有默认的浏览器样式，但是多数元素都有。本书介绍 HTML 元素的各章都会介绍常见浏览器一般都会应用的典型默认样式。

## 3.2. 样式的层叠

明白了浏览器所要查看的所有样式来源之后， 现在可以看看浏览器要显示元素时求索一个 CSS 属性值的次序。这个次序很明确：

1. 行内样式（用元素的全局属性 style 定义的样式）；
2. 内部样式表（定义在 style 元素中的样式）；
3. 外部样式表（用 link 元素导入的样式）；
4. 浏览器样式（浏览器应用的默认样式）。

设想用户需要显示一个 a 元素。浏览器需要知道的一件事情是其文字应显示为哪种颜色。为了解决这个问题，它需要为 CSS 属性 color 找到一个值。首先它会查看所要呈现的那个元素是否具有一条设定了 color 值的行内样式。比如下面这种：

```html
<a style="color: blue;" href="http://www.google.com/">google</a>
```

如果不存在元素内嵌样式， 那么接下来浏览器会看看是否有一个 style 元素包含着作用于那个元素的样式。比如下面这种：

```html
<style>
  a {
  color: red;
  ｝
</style>
```

如果不存在这样的 style 元素，那么浏览器接下来会查看用 link 元素载入的样式表。依次类推，直到找到一个 color 属性值或查完用户定义样式。在后面一种情况下， 最终使用的将是浏览器默认样式中的值。

前述次序表中的前三个属性来源（行内样式、内部样式表和外部样式表）合称作者样式。定义在用户样式表中的样式称为用户样式。由浏览器的默认样式则称为用户代理样式（浏览器样式）。

## 3.3. !important

在样式属性值后用 !important 标记，可以改变正常的层叠次序。

例如：

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      a {
        color: blue !important;
      }
    </style>
    <title>Document</title>
  </head>
  <body>
    <a style="color: red;" href="http://www.baidu.com/">baidu</a>
  </body>
</html>
```

这样浏览器在检查样式时，内部样式表的样式就会被首先查询。因此，这个例子中，超链接文字颜色是蓝色而不是红色。

## 3.4. 样式冲突

在使用内部或外部样式表时，有时可能发生 **样式冲突**。样式冲突是指定义在内部样式表或外部样式表中的多条样式规则可能作用于同一个元素。例如：

```css
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      a{
        color:blue;
      }

      a.myClass{
        color: green;
        background-color: yellow;
      }
    </style>
    <title>Document</title>
  </head>
  <body>
    <!--蓝色文字-->
    <a href="http://www.google.com/">google</a>

    <!--蓝色文字，黄色背景-->
    <a class="myClass" href="http://www.baidu.com/">baidu</a>
  </body>
</html>
```

在这些情况下，为了判断该用哪个值，浏览器会评估两条样式的具体程度，然后选中较为特殊的那条。样式的具体程度通过统计三类特征得出：

- a: 样式的选择器中 id 值的数目；
- b: 选择器中其他属性和伪类的数目；
- c: 选择器中元素名和伪元素的数目。

在评定具体程度时要按 a-b-c 的形式（其中每一个字母依次代表上述三类特征的统计结果）生成一个数字。它不是一个三位数。如果对某个样式算出的 a 值最大，那么它就是具体程度高的那个。只有 a 值相等时浏览器才会比较 b 值，此时 b 值较大的样式具体程度更高。只有 a 值和 b 值都分别相等时浏览器才会考虑 c 值。也就是说，1-0-0 这个得分比 0-5-5 这个得分代表的具体程度更高。

本例中 a.myclass 这个选择器含有一个 class 属性，于是该样式的值为 0-1-0 (0 个 id 值+1 个其他属性+0 个元素名）。另一条样式的具体程度值为 0-0-0（因为它不包含 id 值、其他属性或元素名）。因此浏览器在呈现被归入 myclass 类的 a 元素时将使用 a.myclass 样式中设定的 color 属性值。对于所有其他 a 元素，使用的则是另一条样式中设定的值。

如果同一个样式属性出现在具体程度相当的几条样式中，那么浏览器会根据其位置的先后选择所用的值，规则是后来者居上。

例如：

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      a.myClass1 {
        color: blue;
      }

      a.myClass2 {
        color: red;
      }
    </style>
    <title>Document</title>
  </head>
  <body>
    <!--红色文字-->
    <a class="myClass1 myClass2" href="http://www.baidu.com/">baidu</a>
  </body>
</html>
```

此例 style 元素中定义的两条样式在具体程度上得分相同。因此，超链接应用了第 2 条样式。同样地，如果我们颠倒了这 2 条样式，那么超链接就会变为蓝色文字。读者不妨自行尝试。

根据样式的具体程度和定义次序确定选用的样式属性值，应该把各个属性分开考虑。本节的几个例子还定义了背景颜色属性的值。因为该值并非两个样式中都有，所以不会发生冲突，也就没有必要查找其他值。

## 3.5. 继承

如果浏览器在直接相关的样式中找不到某个属性的值，就会求助于继承机制，使用父元素的这个样式属性值。

例如：

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      p {
        color: white;
        background-color: black;
        border: 1px solid yellow;
      }
    </style>
    <title>Document</title>
  </head>
  <body>
    <p>
      I like
      <!--继承父元素 p 的前景色-->
      <span>apples</span>
      and oranges.
    </p>
  </body>
</html>
```

本例关注的是浏览器应用于 span 元素（其父元素为 p) 的样式。这个文档并没有在针对 span 元素的样式中设定 color 属性值，但是浏览器显示该元素的文字内容时却使用了前景色 white。这个值系由父元素 p 继承而来。

令人挠头的是，并非所有 CSS 属性均可继承。这方面有条经验可供参考：与元素外观（文字颜色、字体等）相关的样式会被继承；与元素在页面上的布局相关的样式不会被继承。在样式中使用 inherit 这个特别设立的值可以强行实施继承，明确指示浏览器在该属性上使用父元素样式中的值。

例如：

```css
span {
  border: inherit;
}
```

此例定义了一条用于 span 元素的样式，其 border 属性值继承自父元素。因此 apples 就会出现黄色边框。
